version: 1
frontend:
  phases:
    preBuild:
      commands:
        - yarn install --frozen-lockfile
    build:
      commands:
        - yarn run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
backend:
  # phases:
  #   build:
  #     commands:
  #       - amplify push --yes
  function:
      FetchEC2Instancies:
        handler: src/index.py
        test:
          runner: jest
          test: src/test_lambda.py
test:
  phases:
    # preTest:
    #   commands:
    #     - *enter command*
    test:
      commands:
        - pwd
        - python3 --version  # Check the Python version
        - python3 -m pip install boto3 moto --user
        - python3 -m pip list --user
        - cd amplify/backend/function/FetchEC2Instances/src/
        - pwd
        - rm -rfv ../logs/ && mkdir -p ../logs/
        - python3 -m unittest test_lambda.py | tee ../logs/test_lambda.logs
  #   postTest:
  #     commands:
  #       - *enter command*
  artifacts:
    baseDirectory: amplify/backend/function/FetchEC2Instances/logs/
    files:
      - '**/*'
